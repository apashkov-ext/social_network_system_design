![logo-mini](https://github.com/user-attachments/assets/a1e75f4e-e214-4f5e-8d4c-29f91fe55a5e)

# phileas.net
Социальная сеть для путешественников, названная в честь путешественника [Филеаса Фогга](https://ru.wikipedia.org/wiki/%D0%A4%D0%B8%D0%BB%D0%B5%D0%B0%D1%81_%D0%A4%D0%BE%D0%B3%D0%B3) из романа Жюля Верна ["Вокруг света за 80 дней"](https://ru.wikipedia.org/wiki/%D0%92%D0%BE%D0%BA%D1%80%D1%83%D0%B3_%D1%81%D0%B2%D0%B5%D1%82%D0%B0_%D0%B7%D0%B0_80_%D0%B4%D0%BD%D0%B5%D0%B9_(%D1%80%D0%BE%D0%BC%D0%B0%D0%BD)).  
Репозиторий является частью домашнего задания к курсу [System Design](https://balun.courses/courses/system_design).

## Требования
### Функциональные
- публикация постов с текстом, фотографиями и ссылкой на локацию;
- оценка и комментарии к посту;
- поиск локаций и отображение их в поисковой выдаче;
- в карточке локации отображение постов, привязанных к локации;
- подписка на путешественников для отслеживания их активности: публикации постов, комментариев;
- (?) просмотр ленты (постов) путешественников в обратном хронологическом порядке (сперва новые);
- (?) просмотр ленты пользователя, основанной на подписках, в обратном хронологическом порядке.

## Нефункциональные
- страны СНГ;
- высокая надежность;
- доступность не ниже 99.95.
- взаимодействие через десктопный и мобильный браузер.
- линейный рост нагрузки;
- сезонность: во время отпусков нагрузка выше;
- хранить данные всегда;
- максимальное кол-во подписчиков: 1000;

## Оценка нагрузки
> ℹ️ Некоторые значения посчитаны и часть информации проанализировано с помощью платформы **ChatGPT**.

DAU через год: 10 000 000

> Численность населения СНГ: 290 000 000  
> В среднем 0.4 поездки в год на человека

**Посты (в день)**
> Постов на одну поездку: 1.5 (1-2 шт).
- новых постов на человека: 0.4 x 1.5 / 265 = 0.00164
- новых постов: 0.00164 x 10 000 000 = 16 400
- чтений постов на человека: 2
- чтений постов: 10 000 000 * 2 = 20 000 000
  
- символов: UTF-8, от 1000 до 20 000, в среднем 10 500
- изображений: от 0 до 10, в среднем 5
- максимальный размер одной картинки: 300 Кб
- размер поста: 10 500 + 5 * 300 * 1024 = 1 546 500 b

- RPS W: 16 400 / 86 400 = 0.19
- RPS R: 20 000 000 / 86 400 = 232
- трафик на запись: 16 400 * 1 546 500 b = 23.6 Gb
- трафик на чтение: 20 000 000 * 1 546 500 b = 28 Tb

**Реакции (в день)**
> Каждый человек может оценить несколько постов.  
> В соцсетях средняя активность по реакциям выше, чем по комментам.
- новых реакций в день на человека: 0.15
- новых реакций в день: 0.15 x 10 000 000 = 1 500 000
- новых реакций в день на пост: 1 500 000 / 16 400 постов = 91.5
- чтений реакций в день: столько же, сколько и постов, то есть 20 000 000
- размер реакции: 1 b

- RPS W: 1 500 000 / 86 400 = 17
- RPS R: 20 000 000 / 86 400 = 232
- трафик на запись: 1 500 000 * 1 b = 1.4 Mb
- трафик на чтение: 1 500 000 * 1 b = 1.4 Mb

**Комментарии (в день)**
> 1–5 комментариев на пост.
> Пусть будет 1.5 коммента на пост для платформы со среднем уровнем вовлеченности.
- новых коментов в день на человека: 24 600 / 10 000 000 = 0.00246
- новых коментов в день: 16 400 постов * 1.5 комментов = 24 600
- комментарии грузятся пачками по 20 штук. Одна пачка - одна операция чтения. Человек загружает по 2 пачки комментариев.  
  чтений комментов в день: 24 600 коментов / 16 400 постов * 20 000 000 чтенйи постов в день = 1.5 * 20 000 000 = 30 000 000
- смволов: UTF-8, от 5 до 500, в среднем 255
- без картинок
- размер коммента: 255 b

- RPS W: 24 600 / 86 400 = 0.3
- RPS R: 20 000 000 / 86 400 = 347
- трафик на запись: 24 600 * 255 b = 6 Mb
- трафик на чтение: 30 000 000 * 255 b = 7.1 Gb

**ИТОГО (в день)**
- RPS W: 0.19 + 17 + 0.3 = 17.5
- RPS R: 20 000 000 / 86 400 = 811
- трафик на запись: 23.6 Gb + 1.4 Mb + 6 Mb = 23.7 Gb
- трафик на чтение: 28 Tb + 1.4 Mb + 7.1 Gb = 28.1 Tb

## API
[Описание API в нотации OpenAPI](https://github.com/apashkov-ext/social_network_system_design/blob/main/api/rest_api.yml).

## База данных
[Схема](https://dbdiagram.io/d/683f554861dc3bf08d6cf66a)

### Оценка объема хранилища на 1 год

**Посты**
Одна запись занимает примерно 12.2 Kb. 
Картинки для одной статьи (в среднем 5 штук): 1500 Kb
Записей за год: 5 986 000 шт = 70 Gb

**Авторы**
Одна запись занимает примерно 125 b. 
Ожидаемое кол-во уникальных авторов за год: 4 600 000 чел = 0.5 Gb

**Подписки**
Среднее количество подписок на человека на примере соцсетей: 30 шт
Одна запись занимает примерно 92 b. 
Подписок в год: 4 600 000 * 30 = 138 000 000 шт = 13 Gb

[BLOB-хранилище] Картинок за год: 16 400 * 5 * 365 = 29 930 000 шт = 42 Tb

**Реакции**
Одна запись занимает примерно 600 b. 
Реакций за год: 547 500 000 шт = 306 Gb

**Комментарии**
Одна запись занимает примерно 600 b. 
Комментариев за год: 8 979 000 шт = 5 Gb

**ИТОГО**
Объем хранилища для базы данных: 395 Gb + 20% запаса = 474 Gb.
С учетом индексов, которые по грубой оценке весят 200 Gb: **714 Gb**
Объем хранилища для картинок: 42 Tb + 20% запаса = **51 Tb**
